name: Update 539 Data Daily

on:
  schedule:
    - cron: '30 14 * * *'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install taiwanlottery
          # 確保有 pandas 處理資料
          pip install pandas 

      - name: Fetch 539 Data
        run: |
          # 建立一個存放資料的資料夾
          mkdir -p data
          # 執行爬蟲並強制存入 data 資料夾
          taiwanlottery --back 1 --game dailycash --output data/539_history.csv

      - name: Commit and Push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/
          # 只有在檔案有變動時才提交，避免重複報錯
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "自動更新 539 數據"
            git push
          else
            echo "沒有新資料需要更新"
          fi
